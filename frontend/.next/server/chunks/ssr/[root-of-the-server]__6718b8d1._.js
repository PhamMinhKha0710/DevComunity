module.exports=[56704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},20635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},3420,(a,b,c)=>{"use strict";b.exports=a.r(31699).vendored.contexts.HooksClientContext},98823,(a,b,c)=>{"use strict";b.exports=a.r(31699).vendored.contexts.ServerInsertedHtml},9449,a=>{"use strict";var b=a.i(57850),c=a.i(45056),d=a.i(93609),e=a.i(40947),f=a.i(45523);function g(){let{user:a,isLoading:g}=(0,e.useAuth)(),h=(0,d.useRouter)(),[i,j]=(0,c.useState)([]),[k,l]=(0,c.useState)(null),[m,n]=(0,c.useState)([]),[o,p]=(0,c.useState)(""),[q,r]=(0,c.useState)(!0),[s,t]=(0,c.useState)(null);(0,c.useEffect)(()=>{g||a?a&&u():h.push("/login")},[a,g,h]),(0,c.useEffect)(()=>{if(!k)return;let a=setInterval(()=>{w()},3e3);return()=>clearInterval(a)},[k,s]);let u=async()=>{try{let a=await f.default.get("/chat/conversations");j(a.data.conversations||[])}catch(a){console.error("Failed to fetch conversations:",a)}finally{r(!1)}},v=async a=>{try{let b=(await f.default.get(`/chat/conversations/${a}/messages`)).data.messages||[];n(b),b.length>0&&t(b[b.length-1].sentAt)}catch(a){console.error("Failed to fetch messages:",a)}},w=async()=>{if(k&&s)try{let a=(await f.default.get(`/chat/conversations/${k}/messages/new?since=${encodeURIComponent(s)}`)).data.messages||[];a.length>0&&(n(b=>[...b,...a]),t(a[a.length-1].sentAt))}catch(a){}},x=async()=>{if(o.trim()&&k)try{await f.default.post(`/chat/conversations/${k}/messages`,{content:o}),p(""),v(k)}catch(a){console.error("Failed to send message:",a)}},y=a=>new Date(a).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return g||q?(0,b.jsx)("div",{className:"container py-5 text-center",children:(0,b.jsx)("div",{className:"spinner-border text-primary",role:"status",children:(0,b.jsx)("span",{className:"visually-hidden",children:"Loading..."})})}):a?(0,b.jsx)("div",{className:"container-fluid py-0",style:{height:"calc(100vh - 160px)"},children:(0,b.jsxs)("div",{className:"row h-100",children:[(0,b.jsxs)("div",{className:"col-md-4 col-lg-3 border-end h-100 d-flex flex-column",children:[(0,b.jsxs)("div",{className:"p-3 border-bottom d-flex justify-content-between align-items-center",children:[(0,b.jsxs)("h5",{className:"mb-0 fw-bold",children:[(0,b.jsx)("i",{className:"bi bi-chat-dots me-2"}),"Messages"]}),(0,b.jsx)("button",{className:"btn btn-sm btn-primary rounded-circle",children:(0,b.jsx)("i",{className:"bi bi-plus"})})]}),(0,b.jsx)("div",{className:"flex-grow-1 overflow-auto",children:i.length>0?(0,b.jsx)("div",{className:"list-group list-group-flush",children:i.map(a=>(0,b.jsx)("button",{onClick:()=>{var b;l(b=a.conversationId),v(b)},className:`list-group-item list-group-item-action p-3 border-0 ${k===a.conversationId?"active":""}`,children:(0,b.jsxs)("div",{className:"d-flex w-100 justify-content-between align-items-start",children:[(0,b.jsxs)("div",{className:"d-flex",children:[(0,b.jsxs)("div",{className:"position-relative me-3",children:[a.participants.length>0?(0,b.jsx)("img",{src:a.participants[0].profilePicture||"/images/default-avatar.png",className:"rounded-circle",width:"48",height:"48",alt:""}):(0,b.jsx)("div",{className:"rounded-circle bg-secondary d-flex align-items-center justify-content-center",style:{width:48,height:48},children:(0,b.jsx)("i",{className:"bi bi-person text-white"})}),a.unreadCount>0&&(0,b.jsx)("span",{className:"position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger",children:a.unreadCount})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h6",{className:"mb-1 fw-semibold",children:a.title||a.participants.map(a=>a.username).join(", ")}),(0,b.jsx)("p",{className:"mb-0 small text-truncate",style:{maxWidth:"150px"},children:a.lastMessage||"No messages yet"})]})]}),(0,b.jsx)("small",{className:"text-muted",children:y(a.lastActivityAt)})]})},a.conversationId))}):(0,b.jsxs)("div",{className:"text-center py-5 text-muted",children:[(0,b.jsx)("i",{className:"bi bi-chat-square-dots fs-1 mb-3"}),(0,b.jsx)("p",{children:"No conversations yet"})]})})]}),(0,b.jsx)("div",{className:"col-md-8 col-lg-9 h-100 d-flex flex-column",children:k?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"p-3 border-bottom bg-white",children:(0,b.jsxs)("div",{className:"d-flex align-items-center",children:[i.find(a=>a.conversationId===k)?.participants[0]&&(0,b.jsx)("img",{src:i.find(a=>a.conversationId===k)?.participants[0].profilePicture||"/images/default-avatar.png",className:"rounded-circle me-3",width:"40",height:"40",alt:""}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h6",{className:"mb-0 fw-bold",children:i.find(a=>a.conversationId===k)?.title||i.find(a=>a.conversationId===k)?.participants.map(a=>a.username).join(", ")}),(0,b.jsxs)("small",{className:"text-success",children:[(0,b.jsx)("i",{className:"bi bi-circle-fill me-1",style:{fontSize:"0.5rem"}}),"Online"]})]})]})}),(0,b.jsx)("div",{className:"flex-grow-1 overflow-auto p-4 bg-light",id:"messagesContainer",children:m.map(c=>(0,b.jsxs)("div",{className:`d-flex mb-3 ${c.senderId===a.userId?"justify-content-end":"justify-content-start"}`,children:[c.senderId!==a.userId&&(0,b.jsx)("img",{src:c.senderAvatar||"/images/default-avatar.png",className:"rounded-circle me-2 align-self-end",width:"32",height:"32",alt:""}),(0,b.jsxs)("div",{className:`p-3 rounded-4 ${c.senderId===a.userId?"bg-primary text-white":"bg-white border"}`,style:{maxWidth:"70%"},children:[(0,b.jsx)("p",{className:"mb-1",children:c.content}),(0,b.jsx)("small",{className:c.senderId===a.userId?"text-white-50":"text-muted",children:y(c.sentAt)})]})]},c.messageId))}),(0,b.jsx)("div",{className:"p-3 border-top bg-white",children:(0,b.jsxs)("div",{className:"input-group",children:[(0,b.jsx)("input",{type:"text",className:"form-control rounded-pill border-end-0",placeholder:"Type a message...",value:o,onChange:a=>p(a.target.value),onKeyPress:a=>"Enter"===a.key&&x()}),(0,b.jsx)("button",{className:"btn btn-primary rounded-pill ms-2",onClick:x,disabled:!o.trim(),children:(0,b.jsx)("i",{className:"bi bi-send"})})]})})]}):(0,b.jsxs)("div",{className:"flex-grow-1 d-flex flex-column align-items-center justify-content-center text-muted",children:[(0,b.jsx)("i",{className:"bi bi-chat-square-dots fs-1 mb-3"}),(0,b.jsx)("h5",{children:"Select a conversation"}),(0,b.jsx)("p",{children:"Choose a conversation from the list or start a new one"})]})})]})}):null}a.s(["default",()=>g])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__6718b8d1._.js.map