(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,96086,(e,s,t)=>{s.exports=e.r(9187)},56926,e=>{"use strict";var s=e.i(48277),t=e.i(30668),a=e.i(96086),i=e.i(23959),n=e.i(96800);function l(){let{user:e,isLoading:l}=(0,i.useAuth)(),r=(0,a.useRouter)(),[c,d]=(0,t.useState)([]),[o,m]=(0,t.useState)(null),[h,u]=(0,t.useState)([]),[x,g]=(0,t.useState)(""),[p,f]=(0,t.useState)(!0),[j,b]=(0,t.useState)(null);(0,t.useEffect)(()=>{l||e?e&&v():r.push("/login")},[e,l,r]),(0,t.useEffect)(()=>{if(!o)return;let e=setInterval(()=>{y()},3e3);return()=>clearInterval(e)},[o,j]);let v=async()=>{try{let e=await n.default.get("/chat/conversations");d(e.data.conversations||[])}catch(e){console.error("Failed to fetch conversations:",e)}finally{f(!1)}},N=async e=>{try{let s=(await n.default.get(`/chat/conversations/${e}/messages`)).data.messages||[];u(s),s.length>0&&b(s[s.length-1].sentAt)}catch(e){console.error("Failed to fetch messages:",e)}},y=async()=>{if(o&&j)try{let e=(await n.default.get(`/chat/conversations/${o}/messages/new?since=${encodeURIComponent(j)}`)).data.messages||[];e.length>0&&(u(s=>[...s,...e]),b(e[e.length-1].sentAt))}catch(e){}},w=async()=>{if(x.trim()&&o)try{await n.default.post(`/chat/conversations/${o}/messages`,{content:x}),g(""),N(o)}catch(e){console.error("Failed to send message:",e)}},I=e=>new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return l||p?(0,s.jsx)("div",{className:"container py-5 text-center",children:(0,s.jsx)("div",{className:"spinner-border text-primary",role:"status",children:(0,s.jsx)("span",{className:"visually-hidden",children:"Loading..."})})}):e?(0,s.jsx)("div",{className:"container-fluid py-0",style:{height:"calc(100vh - 160px)"},children:(0,s.jsxs)("div",{className:"row h-100",children:[(0,s.jsxs)("div",{className:"col-md-4 col-lg-3 border-end h-100 d-flex flex-column",children:[(0,s.jsxs)("div",{className:"p-3 border-bottom d-flex justify-content-between align-items-center",children:[(0,s.jsxs)("h5",{className:"mb-0 fw-bold",children:[(0,s.jsx)("i",{className:"bi bi-chat-dots me-2"}),"Messages"]}),(0,s.jsx)("button",{className:"btn btn-sm btn-primary rounded-circle",children:(0,s.jsx)("i",{className:"bi bi-plus"})})]}),(0,s.jsx)("div",{className:"flex-grow-1 overflow-auto",children:c.length>0?(0,s.jsx)("div",{className:"list-group list-group-flush",children:c.map(e=>(0,s.jsx)("button",{onClick:()=>{var s;m(s=e.conversationId),N(s)},className:`list-group-item list-group-item-action p-3 border-0 ${o===e.conversationId?"active":""}`,children:(0,s.jsxs)("div",{className:"d-flex w-100 justify-content-between align-items-start",children:[(0,s.jsxs)("div",{className:"d-flex",children:[(0,s.jsxs)("div",{className:"position-relative me-3",children:[e.participants.length>0?(0,s.jsx)("img",{src:e.participants[0].profilePicture||"/images/default-avatar.png",className:"rounded-circle",width:"48",height:"48",alt:""}):(0,s.jsx)("div",{className:"rounded-circle bg-secondary d-flex align-items-center justify-content-center",style:{width:48,height:48},children:(0,s.jsx)("i",{className:"bi bi-person text-white"})}),e.unreadCount>0&&(0,s.jsx)("span",{className:"position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger",children:e.unreadCount})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h6",{className:"mb-1 fw-semibold",children:e.title||e.participants.map(e=>e.username).join(", ")}),(0,s.jsx)("p",{className:"mb-0 small text-truncate",style:{maxWidth:"150px"},children:e.lastMessage||"No messages yet"})]})]}),(0,s.jsx)("small",{className:"text-muted",children:I(e.lastActivityAt)})]})},e.conversationId))}):(0,s.jsxs)("div",{className:"text-center py-5 text-muted",children:[(0,s.jsx)("i",{className:"bi bi-chat-square-dots fs-1 mb-3"}),(0,s.jsx)("p",{children:"No conversations yet"})]})})]}),(0,s.jsx)("div",{className:"col-md-8 col-lg-9 h-100 d-flex flex-column",children:o?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"p-3 border-bottom bg-white",children:(0,s.jsxs)("div",{className:"d-flex align-items-center",children:[c.find(e=>e.conversationId===o)?.participants[0]&&(0,s.jsx)("img",{src:c.find(e=>e.conversationId===o)?.participants[0].profilePicture||"/images/default-avatar.png",className:"rounded-circle me-3",width:"40",height:"40",alt:""}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h6",{className:"mb-0 fw-bold",children:c.find(e=>e.conversationId===o)?.title||c.find(e=>e.conversationId===o)?.participants.map(e=>e.username).join(", ")}),(0,s.jsxs)("small",{className:"text-success",children:[(0,s.jsx)("i",{className:"bi bi-circle-fill me-1",style:{fontSize:"0.5rem"}}),"Online"]})]})]})}),(0,s.jsx)("div",{className:"flex-grow-1 overflow-auto p-4 bg-light",id:"messagesContainer",children:h.map(t=>(0,s.jsxs)("div",{className:`d-flex mb-3 ${t.senderId===e.userId?"justify-content-end":"justify-content-start"}`,children:[t.senderId!==e.userId&&(0,s.jsx)("img",{src:t.senderAvatar||"/images/default-avatar.png",className:"rounded-circle me-2 align-self-end",width:"32",height:"32",alt:""}),(0,s.jsxs)("div",{className:`p-3 rounded-4 ${t.senderId===e.userId?"bg-primary text-white":"bg-white border"}`,style:{maxWidth:"70%"},children:[(0,s.jsx)("p",{className:"mb-1",children:t.content}),(0,s.jsx)("small",{className:t.senderId===e.userId?"text-white-50":"text-muted",children:I(t.sentAt)})]})]},t.messageId))}),(0,s.jsx)("div",{className:"p-3 border-top bg-white",children:(0,s.jsxs)("div",{className:"input-group",children:[(0,s.jsx)("input",{type:"text",className:"form-control rounded-pill border-end-0",placeholder:"Type a message...",value:x,onChange:e=>g(e.target.value),onKeyPress:e=>"Enter"===e.key&&w()}),(0,s.jsx)("button",{className:"btn btn-primary rounded-pill ms-2",onClick:w,disabled:!x.trim(),children:(0,s.jsx)("i",{className:"bi bi-send"})})]})})]}):(0,s.jsxs)("div",{className:"flex-grow-1 d-flex flex-column align-items-center justify-content-center text-muted",children:[(0,s.jsx)("i",{className:"bi bi-chat-square-dots fs-1 mb-3"}),(0,s.jsx)("h5",{children:"Select a conversation"}),(0,s.jsx)("p",{children:"Choose a conversation from the list or start a new one"})]})})]})}):null}e.s(["default",()=>l])}]);